var $=jQuery;$('.'+wcLsJson.dobInput).datepicker({changeYear:!0,defaultDate:(new Date(1910,1,1)),yearRange:wcLsJson.dateRange,dateFormat:'dd-mm-yy'});var wcLsPhoneErrorMap=["Invalid number","Invalid country code","Too short","Too long","Invalid number"];var wcLsPhoneIntl=$('.wc-ls-intl input').intlTelInput({utilsScript:wcLsJson.utilsScript});var wcLsphoneErrMsg="";function wcLsValidatePhone(input){const phone=input;let result=!1;if(phone.intlTelInput("isValidNumber")==!0){result=phone.intlTelInput("getNumber")}
else{let errorCode=phone.intlTelInput("getValidationError");wcLsphoneErrMsg=`Phone validation error: ${wcLsPhoneErrorMap[errorCode]}`}
return result}
function wcLsLoyaltySubmit(){let formBody='form.ls-loyalty-widget-box';$(formBody).prepend('<div class="ls-blanket center"><a href="#no-click" class="ls-nice-load-feel"><i class="fa fa-gear fa-spin fa-2x"></i></a> </div>');$(formBody).css('position','relative');let wcLsFormData={};let wcLsForm=$(formBody).serializeArray();const alertBox=`${formBody} .wc-ls-alert`;if(wcLsForm===undefined||wcLsForm.length<1){wcLsShowWidgetNote('Please fill in the details','danger');wcLsRemoveOverlay(formBody);return}
let _formData={};for(let i=0;i<wcLsForm.length;i++){_formData[wcLsForm[i].name]=wcLsForm[i].value}
_formData.u_id=wcLsJson.userId;_formData.nonce=wcLsJson.nonce;_formData.phone=wcLsValidatePhone(wcLsPhoneIntl);if(_formData.phone==!1){wcLsShowWidgetNote(wcLsphoneErrMsg,'danger');wcLsRemoveOverlay(formBody);return}
wcLsFormData=_formData;$.ajax({url:wcLsJson.url+'wc_ls/v1/loyalty_widget/',method:'POST',beforeSend:function(xhr){xhr.setRequestHeader('X-WP-Nonce',wcLsJson.nonce)},data:wcLsFormData}).success(function(response){wcLsShowWidgetNote(response,'success');wcLsRemoveOverlay(formBody);window.setTimeout(function(){window.location.href=wcLsJson.pageUrl},3000)}).fail(function(jqXHR){const stateCode=jqXHR.status;let msg="";response=JSON.parse(jqXHR.responseText);if(stateCode!==422&&stateCode!==503)
msg="Sorry, an internal error occured, try again later.";else msg=response;wcLsShowWidgetNote(msg,'danger');wcLsRemoveOverlay(formBody);return})}
function wcLsShowWidgetNote(msg,type="success"){const alertBox=`form.ls-loyalty-widget-box .wc-ls-alert`;$(alertBox).attr('class','wc-ls-alert ls-'+type);$(alertBox).text(msg);$(alertBox).removeClass('hidden');$(alertBox).fadeIn('slow')}
function wcLsRemoveOverlay(parentElement='form.ls-loyalty-widget-box'){$(parentElement+' .ls-blanket').remove()}
var wcLsCheckoutForm=$('.woocommerce-checkout');wcLsCheckoutForm.on('checkout_place_order',function(){let phoneNumber=wcLsValidatePhone(wcLsPhoneIntl);if(phoneNumber!=!1){$('.woocommerce-checkout input#billing_phone').val(phoneNumber);if($('#wc-ls-phone-valid-field').length==0){wcLsCheckoutForm.append(`<input id="wc-ls-phone-valid-field" value="${phoneNumber}" type="hidden" name="${wcLsJson.phoneValidatorName}">`)}}
else{if($('#wc-ls-phone-valid-field-err-msg').length==0){wcLsCheckoutForm.append(`<input id="wc-ls-phone-valid-field-err-msg" value="${wcLsphoneErrMsg}" type="hidden" name="${wcLsJson.phoneValidatorErrName}">`)}}})